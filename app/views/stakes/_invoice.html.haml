- totaldue = 0
#header
  %p
    = "Invoice ##{stake.id.to_s}"

  %h1
    Kuusi Palaa osk
  .metadata
    Kolmas linja 7, 00530 Helsinki, Finland
    %br/
    Y-tunnus: 2880614-5
  %h2 Invoice
.content
  .row
    .heading Invoice for:
    .value= stake.owner.name
  .row
    .heading Date:
    .value= Time.now.utc.strftime("%d.%m.%Y")
  .row
    %table
      %thead
        %th Item
        %th Price
        %th Quantity
        %th Total
      %tbody
        - if stake.includes_share
          %tr
            %td Share/osuus in Kuusi Palaa osk
            %td= number_to_currency(10, unit: raw('&euro;'), format: "%n %u")
            %td 1
            %td= number_to_currency(10, unit: raw('&euro;'), format: "%n %u")
            - totaldue += 10
        - if stake.includes_membership_fee
          %tr
            %td
              Membership fee for #{stake.created_at.strftime("%Y")}
            %td= number_to_currency(40, unit: raw('&euro;'), format: "%n %u")
            %td 1
            %td= number_to_currency(40, unit: raw('&euro;'), format: "%n %u")
            - totaldue += 40
        %tr
          %td
            Kuusi Palaa 'stake' service for season ##{stake.season.number.to_s}
            - if stake.includes_share || stake.includes_membership_fee
              first stake price
          - if stake.amount == 1 || stake.includes_membership_fee
            - if stake.includes_share && stake.includes_membership_fee
              - sa = 0
              %td= number_to_currency(0, unit: raw('&euro;'), format: "%n %u")
            - elsif !stake.includes_share && stake.includes_membership_fee
              - sa = 10
              %td= number_to_currency(10, unit: raw('&euro;'), format: "%n %u")
            - else
              - sa = 50
              %td= number_to_currency(50, unit: raw('&euro;'), format: "%n %u")

            %td 1
            %td= number_to_currency(sa, unit: raw('&euro;'), format: "%n %u")
            - totaldue += sa
          - else
            %td= number_to_currency(50, unit: raw('&euro;'), format: "%n %u")
            %td= stake.amount.to_s
            %td= number_to_currency(stake.amount * 50, unit: raw('&euro;'), format: "%n %u")
            - totaldue += stake.amount * 50
        - if stake.amount > 1 && stake.includes_membership_fee
          %tr
            %td
              Kuusi Palaa 'stake' service for season ##{stake.season.number.to_s}
            %td= number_to_currency(50, unit: raw('&euro;'), format: "%n %u")
            %td= (stake.amount - 1).to_s
            %td= number_to_currency((stake.amount - 1) * 50, unit: raw('&euro;'), format: "%n %u")
            - totaldue += (stake.amount - 1) * 50
        %tfoot
          %th{colspan: 2} &nbsp;
          %th Total due:
          %th= number_to_currency(totaldue, unit: raw('&euro;'), format: "%n %u")
  .row
    .heading Payment to:
    .value Kuusi Palaa osk
  .row
    .heading Account number:
    .value= ENV['iban']
  .row
    .heading BIC/SWIFT:
    .value= ENV['swift']
  .row
    .heading Reference/viitenumero:
    .value= stake.viitenumero.paper_format
  .row
    .heading Due date:
    .value= stake.invoice_due.strftime("%d.%m.%Y")
