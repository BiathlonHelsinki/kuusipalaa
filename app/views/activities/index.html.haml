

.activities_index
  %article
    .row.front_box{class: @kp_is_open.to_s}
      .small-12.columns.small-centered.text-center
        = link_to event_instance_path('kuusi-palaa', 'kuusi-palaa-season-1') do
          .banner_blurb
            - if @kp_is_open
              = t :kp_is_currently_open
              .smaller= t :all_are_welcome
            - else
              = t :kp_is_currently_closed
              .smaller= t :not_a_stakeholder_come_some_other_time
  = link_to 'Subscribe', '#', class: :'webpush-button'         
  - @activities.each do |activity|
    = render partial: 'activities/activity', locals: {activity: activity}

.row
  .small-12.columns= paginate @activities

= render partial: 'vapid'

= content_for :jquery do
  :plain
    $('.webpush-button').on('click', (e) => {
      navigator.serviceWorker.ready
      .then((serviceWorkerRegistration) => {
        serviceWorkerRegistration.pushManager.getSubscription()
        .then((subscription) => {
          $.post('/push', {
            subscription: subscription.toJSON(),
            message: 'You clicked a button!'
          });
        });
      });
    });